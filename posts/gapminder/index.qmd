---
title: "Gapminder: how has the world changed?"
description: "A fresh take on the classic gapminder animation."
author: Nicola Rennie
date: "2025/01/31"
image: images/featured.png
execute: 
  eval: true
  echo: false
  warning: false
freeze: auto
format:
  closeread-html:
    css: gapminder.css
    cr-style:
      narrative-background-color-sidebar: "#DB778F"
      narrative-text-color-sidebar: "#40111C"
      section-background-color: "#FFFFFF"
      narrative-font-size: 14pt
      narrative-font-family: Ubuntu
    remove-header-space: true
    debug-mode: false
    embed-resources: true
---

```{r}
#| label: load-data
#| echo: false
#| message: false
#| warning: false
#| output: false
#| eval: true
# packages
library(gapminder)
library(ggplot2)
library(dplyr)
library(PrettyCols)
library(ggtext)
library(glue)
library(showtext)
library(ggiraph)
# data
gapminder2007 <- gapminder |>
  filter(year == 2007)
# colours
col_palette <- prettycols("Celestial")[1:5]
names(col_palette) <- unique(gapminder$continent)
bg_col <- "white"
highlight_col <- "#DB778F"
text_col <- "#40111C"
# fonts
font_add_google("Ubuntu")
showtext_auto()
showtext_opts(dpi = 300)
body_font <- "Ubuntu"
gdtools::register_gfont("Ubuntu")
```

:::{.cr-section}

:::{#cr-anim-plot .scale-to-fill}

```{r}
#| label: anim-plot
#| fig-width: 6
#| fig-height: 4
#| fig-align: center
#| fig-dpi: 300
plot(1:10)
```
:::

:::{#cr-main-plot .scale-to-fill}

```{r}
#| label: main-plot
#| fig-width: 6
#| fig-height: 4
#| fig-align: center
#| fig-dpi: 300
g <- ggplot(
  data = gapminder2007,
  mapping = aes(
    x = gdpPercap, y = lifeExp,
    size = pop, colour = continent,
    fill = continent
  )
) +
  geom_hline(yintercept = median(gapminder2007$lifeExp)) +
  geom_vline(xintercept = median(gapminder2007$gdpPercap)) +
  geom_point_interactive(
    pch = 21, alpha = 0.6,
    mapping = aes(tooltip = country)
  ) +
  scale_x_log10() +
  scale_colour_manual(
    values = col_palette
  ) +
  scale_fill_manual(
    values = col_palette
  ) +
  labs(
    title = "What does the world look like in 2007?",
    x = "GDP per capita (inflation-adjusted US dollars)",
    y = "Life expectancy at birth (years)",
    subtitle = glue("Though every area of the world has seen changes in life expectancy and GDP over time, there are still disparities between <span style='color:{col_palette[1]}'>**{names(col_palette)[1]}**</span>, <span style='color:{col_palette[2]}'>**{names(col_palette)[2]}**</span>, <span style='color:{col_palette[3]}'>**{names(col_palette)[3]}**</span>, <span style='color:{col_palette[4]}'>**{names(col_palette)[4]}**</span>, and <span style='color:{col_palette[5]}'>**{names(col_palette)[5]}**</span>.")
  ) +
  theme_bw(base_family = body_font, base_size = 16) +
  theme(
    legend.position = "none",
    plot.title = element_textbox_simple(
      colour = text_col,
      hjust = 0,
      halign = 0,
      family = body_font,
      face = "bold",
      margin = margin(b = 0, t = 5)
    ),
    plot.subtitle = element_textbox_simple(
      colour = text_col,
      hjust = 0,
      halign = 0,
      family = body_font,
      margin = margin(b = 10, t = 10)
    )
  )
girafe(ggobj = g)
```

:::

:::{focus-on="cr-anim-plot" .scale-to-fill}

# Gapminder: how has the world changed?

*Gapminder is an independent educational non-proﬁt ﬁghting global misconceptions.* <br><br>

by Nicola Rennie

:::

:::{#cr-gdp .scale-to-fill}

```{r}
#| label: gdp-plot
#| fig-width: 6
#| fig-height: 4
#| fig-align: center
#| fig-dpi: 300
ggplot(
  data = gapminder,
  mapping = aes(
    x = year, y = gdpPercap,
    colour = continent,
    fill = continent
  )
) +
  geom_smooth(alpha = 0.3) +
  facet_wrap(~continent, nrow = 1) +
  scale_colour_manual(
    values = col_palette
  ) +
  scale_fill_manual(
    values = col_palette
  ) +
  scale_x_continuous(breaks = c(1960, 1980, 2000)) +
  labs(
    title = "GDP",
    x = NULL,
    y = "GDP per capita (inflation-adjusted US dollars)"
  ) +
  theme_bw(base_family = body_font, base_size = 16) +
  theme(
    legend.position = "none",
    plot.title = element_textbox_simple(
      colour = text_col,
      hjust = 0,
      halign = 0,
      family = body_font,
      face = "bold",
      margin = margin(b = 10, t = 5)
    )
  )
```

:::

:::{focus-on="cr-gdp"}

## GDP

:::

:::{#cr-pop .scale-to-fill}

```{r}
#| label: pop-plot
#| fig-width: 6
#| fig-height: 4
#| fig-align: center
#| fig-dpi: 300
ggplot(
  data = gapminder,
  mapping = aes(
    x = year, y = pop,
    colour = continent,
    fill = continent
  )
) +
  geom_smooth(alpha = 0.3) +
  facet_wrap(~continent, nrow = 1) +
  scale_colour_manual(
    values = col_palette
  ) +
  scale_fill_manual(
    values = col_palette
  ) +
  scale_x_continuous(breaks = c(1960, 1980, 2000)) +
  labs(
    title = "Population",
    x = NULL,
    y = "Population"
  ) +
  theme_bw(base_family = body_font, base_size = 16) +
  theme(
    legend.position = "none",
    plot.title = element_textbox_simple(
      colour = text_col,
      hjust = 0,
      halign = 0,
      family = body_font,
      face = "bold",
      margin = margin(b = 10, t = 5)
    )
  )
```

:::

:::{focus-on="cr-pop"}

## Population

:::

:::{#cr-lifeExp .scale-to-fill}

```{r}
#| label: lifeExp-plot
#| fig-width: 6
#| fig-height: 4
#| fig-align: center
#| fig-dpi: 300
ggplot(
  data = gapminder,
  mapping = aes(
    x = year, y = lifeExp,
    colour = continent,
    fill = continent
  )
) +
  geom_smooth(alpha = 0.3) +
  facet_wrap(~continent, nrow = 1) +
  scale_colour_manual(
    values = col_palette
  ) +
  scale_fill_manual(
    values = col_palette
  ) +
  scale_x_continuous(breaks = c(1960, 1980, 2000)) +
  labs(
    title = "Life expectancy",
    x = NULL,
    y = "Life expectancy at birth (years)"
  ) +
  theme_bw(base_family = body_font, base_size = 16) +
  theme(
    legend.position = "none",
    plot.title = element_textbox_simple(
      colour = text_col,
      hjust = 0,
      halign = 0,
      family = body_font,
      face = "bold",
      margin = margin(b = 10, t = 5)
    )
  )
```

:::

:::{focus-on="cr-lifeExp"}

## Life expectancy

:::

:::{focus-on="cr-main-plot" .scale-to-fill}

## 2007

statement about general trend

Lines indicate 

:::


:::{focus-on="cr-main-plot" pan-to="-62%,65%" scale-by="2.3"}
## High income, high life expectancy

Add text

:::

:::{focus-on="cr-main-plot" pan-to="62%,65%" scale-by="2.3"}
## Low income, high life expectancy

Add text

:::

:::{focus-on="cr-main-plot" pan-to="62%,-65%" scale-by="2.3"}
## Low income, low life expetancy

Add text

:::

:::{focus-on="cr-main-plot" pan-to="-62%,-65%" scale-by="2.3"}
## High income, low life expectancy

Add text

:::

:::{focus-on="cr-anim-plot" .scale-to-fill}

*Nice quote*

<br>

{{< fa globe >}} [nrennie.rbind.io](https://nrennie.rbind.io/)

<br>

{{< fa brands linkedin >}} [nicola-rennie](https://www.linkedin.com/in/nicola-rennie/)

<br>

{{< fa brands github >}} [nrennie](https://github.com/nrennie)

:::

:::
